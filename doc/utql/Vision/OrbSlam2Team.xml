<?xml version="1.0" encoding="UTF-8"?>

<UTQLPatternTemplates xmlns='http://ar.in.tum.de/ubitrack/utql'
	xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
	xmlns:xi='http://www.w3.org/2001/XInclude'
	xmlns:h="http://www.w3.org/1999/xhtml"
	xsi:schemaLocation='http://ar.in.tum.de/ubitrack/utql ../../../schema/utql_templates.xsd'>

	<Pattern name="OrbSlam2TeamStereo" displayName="ORB-SLAM2-TEAM Stereo">
		<Description>
			<h:p>
				
			</h:p>
		</Description>
		<Input>
			<Node name="CameraL" displayName="Camera Left" />
			<Node name="ImagePlaneL" displayName="Image Plane Left" />
			<Node name="CameraR" displayName="Camera Right" />
			<Node name="ImagePlaneR" displayName="Image Plane Right" />
			<Edge name="ImageInputL" source="CameraL" destination="ImagePlaneL" displayName="Image Input Left">
				<Description>
					<h:p>3-channel and 4-channel color images automatically converted to gray images</h:p>
				</Description>
				<Predicate>type=='Image'</Predicate>
			</Edge>
			<Edge name="ImageInputR" source="CameraR" destination="ImagePlaneR" displayName="Image Input Right">
				<Description>
					<h:p>3-channel and 4-channel color images automatically converted to gray images</h:p>
				</Description>
				<Predicate>type=='Image'</Predicate>
			</Edge>
		</Input>
    <Output>
      <Node name="Mapper" displayName="Mapper Origin">
        <Attribute name="mapperId" displayName="Mapper ID" min="1" max="20" default="1" xsi:type="IntAttributeDeclarationType">
          <Description>
            <p xmlns="http://www.w3.org/1999/xhtml">Unique identifier for the Mapper</p>
          </Description>
        </Attribute>
        <Attribute name="vocabularyFile" default="" displayName="Vocabulary File" xsi:type="PathAttributeDeclarationType">
          <Description>
            <h:p>
              Required: Path and file name of the vocabulary file. For example: <h:code>ORB_SLAM2_TEAM/Vocabulary/ORBvoc.bin</h:code>
            </h:p>
          </Description>
        </Attribute>
        <Attribute name="maxTrackers" displayName="Maximum Tracker Quantity" min="1" max="10" default="1" xsi:type="IntAttributeDeclarationType">
          <Description>
            <p xmlns="http://www.w3.org/1999/xhtml">Maximum number of trackers in the SRG</p>
          </Description>
        </Attribute>
      </Node>
      <Node name="ImagePlaneDebugL" displayName="Image Plane Debug Left" />
      <Edge name="Output" source="Mapper" destination="CameraL" displayName="Camera Left Pose">
        <Description>
          <h:p></h:p>
        </Description>
        <Attribute name="type" value="6D" xsi:type="EnumAttributeReferenceType"/>
      </Edge>
      <Edge name="OutputError" source="Mapper" destination="CameraL" displayName="Camera Left Error Pose">
        <Description>
          <h:p></h:p>
        </Description>
        <Attribute name="type" value="6DError" xsi:type="EnumAttributeReferenceType"/>
        <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
      </Edge>
      <Edge name="ImageDebugL" source="CameraL" destination="ImagePlaneDebugL" displayName="Image Debug Left">
        <Description>
          <h:p>The debug image is larger than the input image. It has a footer with tracking status information.</h:p>
        </Description>
        <Attribute name="type" value="Image" xsi:type="EnumAttributeReferenceType"/>
        <Attribute name="mode" value="push" xsi:type="EnumAttributeReferenceType"/>
      </Edge>
    </Output>

      <Constraints>
         <TriggerGroup>
            <Edge edge-ref="ImageInputL"/>
            <Edge edge-ref="ImageInputR"/>
            <Edge edge-ref="Output"/>
         </TriggerGroup>
      </Constraints>

      <DataflowConfiguration>
         <UbitrackLib class="OrbSlam2TeamStereo" />
         <Attribute name="settingsFile" default="" displayName="Settings File" xsi:type="PathAttributeDeclarationType">
             <Description>
               <h:p>Required: Path and file name of the settings file. For example: <h:code>ORB_SLAM2_TEAM/Examples/Stereo/EuRoC.yaml</h:code></h:p>
               </Description>
         </Attribute>
         <Attribute name="maxDelay" default="20" xsi:type="IntAttributeDeclarationType" displayName="Max Delay">
            <Description>
               <h:p>Maximum Delay in ms</h:p>
            </Description>
         </Attribute>
         <Attribute name="addErrorX" displayName="x-axis additional error" default="0" min="0" xsi:type="DoubleAttributeDeclarationType">
             <Description><h:p>Square root of the x-axis covariance that will be added to error pose.</h:p></Description>
         </Attribute>
         <Attribute name="addErrorY" displayName="y-axis additional error" default="0" min="0" xsi:type="DoubleAttributeDeclarationType">
             <Description><h:p>Square root of the y-axis covariance that will be added to error pose.</h:p></Description>
         </Attribute>
         <Attribute name="addErrorZ" displayName="z-axis additional error" default="0" min="0" xsi:type="DoubleAttributeDeclarationType">
             <Description><h:p>Square root of the z-axis covariance that will be added to error pose.</h:p></Description>
         </Attribute>
      </DataflowConfiguration>
   </Pattern>


   <!-- Attribute declarations -->

   <GlobalNodeAttributeDeclarations>
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/1/1)" />
   </GlobalNodeAttributeDeclarations>

   <GlobalEdgeAttributeDeclarations>
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/1)" />
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/2)" />
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/3)" />
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/4)" />
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/5)" />
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/6)" />
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/7)" />
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/2/8)" />
   </GlobalEdgeAttributeDeclarations>

   <GlobalDataflowAttributeDeclarations>
      <!-- Unfortunately, the xpointer used in Xinclude is currently restricted to the element scheme and absolute element indices in Xerces (and thus XMLBeans) -->
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/1)" />
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/2)" />
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/3)"/>
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/4)"/>
      <xi:include href="file:GlobalAttrSpec.xml" xpointer="element(/1/3/5)"/>
   </GlobalDataflowAttributeDeclarations>

</UTQLPatternTemplates>

